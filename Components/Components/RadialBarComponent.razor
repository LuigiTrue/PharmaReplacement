@using RepyPharma.Components.Components
@rendermode InteractiveServer
@using ApexCharts
@using System.Runtime.CompilerServices
@inject IOrderService OrderService


@if (Orders is null)
{
    <ApexChart TItem="Order" Height="300" Width="300">
        <LoadingRingComponent Indeterminate="true" Quantidade="1"></LoadingRingComponent>
    </ApexChart>
}
else
{
    @foreach (var order in Orders)
    {
        <ApexChart TItem="Order" Height="300" Width="300" Options="BuildOptions(order)">
            <ApexPointSeries TItem="Order" Items="new List<Order> { order }" SeriesType="SeriesType.RadialBar"
                             XValue="@(e => e.RemedyName)" YValue="@(e => e.PercentageStock)" />
        </ApexChart>
    }
}



@code {

    [Parameter]
    public List<Order>? Orders { get; set; }
    [Parameter] public string? Title { get; set; }




    private ApexChartOptions<Order> BuildOptions(Order order)
    {
        return new ApexChartOptions<Order>
        {
            Chart = new Chart
            {
                Type = ChartType.RadialBar
            },
            Labels = new List<string>
            {
                order.RemedyName
            },
            PlotOptions = new PlotOptions
            {
                RadialBar = new PlotOptionsRadialBar
                {
                    DataLabels = new RadialBarDataLabels
                    {
                        Show = true,
                        Name = new RadialBarDataLabelsName
                        {
                            Show = true,
                            FontSize = "1rem"
                        },
                        Value = new RadialBarDataLabelsValue
                        {
                            Show = true,
                            FontSize = "0.8rem"
                        }
                    }
                }
            }
        };
    }


    protected override async Task OnInitializedAsync()
    {
        //Simulação de carregamento de dados
        await Task.Delay(2000);
        Orders = await OrderService.GetOrdersAsync();
    }
}